if(typeof dvizh=="undefined"||!dvizh){var dvizh={}}dvizh.cart={init:function(){cartElementsCount="[data-role=cart-element-count]";buyElementButton="[data-role=cart-buy-button]";deleteElementButton="[data-role=cart-delete-button]";truncateCartButton="[data-role=truncate-cart-button]";dvizh.cart.csrf=jQuery("meta[name=csrf-token]").attr("content");dvizh.cart.csrf_param=jQuery("meta[name=csrf-param]").attr("content");jQuery(document).on("change",cartElementsCount,function(){var a=this,b=jQuery(a).data("href");if(jQuery(a).val()<0){jQuery(a).val("0");return false}cartElementId=jQuery(a).data("id");cartElementCount=jQuery(a).val();cartQuantityUrl=jQuery(a).data("cart-quantity-url");jQuery.ajax({url:cartQuantityUrl,type:"post",data:{id:cartElementId,quantity:cartElementCount},success:function(c){json=JSON.parse(c);if(json.bool==true){dvizh.cart.changeElementCount(cartElementId,cartElementCount,b);dvizh.cart.changeElementCost(cartElementId,cartElementCount,b)}else{swal("Upozornění!",json.error,"warning");jQuery(a).val(json.quantity)}}})});jQuery(document).on("click",buyElementButton,function(){if(jQuery("#options-exist-flag").val()&&!jQuery(".dvizh-option-values-before").val()){swal("Vyberte termín!","Nevybrali jste žádný termín, nejprve musíte vybrat termín!","error");return false}var g=this,d=jQuery(g).data("url"),j=jQuery(g).data("product-url"),b=jQuery(g).data("product-option-url"),e=jQuery(g).data("model"),f=jQuery(g).data("id"),a=jQuery(g).data("count"),i=jQuery(g).data("price"),h=jQuery(g).data("options");var c=jQuery("#options-exist-flag").val()?b:j;jQuery.ajax({url:c,type:"post",data:{productId:f,productOptionId:h,quantity:a},success:function(k){json=JSON.parse(k);if(json.bool==true){dvizh.cart.addElement(e,f,a,i,h,d);swal({title:"Přidáno do košíku!",type:"success",html:"Chcete přejít do košíku?",showCloseButton:true,showCancelButton:true,focusConfirm:false,confirmButtonText:'<i class="fa fa-shopping-cart"></i> Do košíku!',confirmButtonAriaLabel:"Thumbs up, great!",cancelButtonText:'<i class="fa fa-times"></i> Zůstat zde',cancelButtonAriaLabel:"Thumbs down"}).then(function(l){if(l.value==true){window.location="/order/cart"}})}else{swal("Upozornění!",json.error,"warning")}}});return false});jQuery(document).on("click",truncateCartButton,function(){var a=this,b=jQuery(a).data("url");dvizh.cart.truncate(b);return false});jQuery(document).on("click",deleteElementButton,function(d){d.preventDefault();var b=this,c=jQuery(b).data("url"),a=jQuery(b).data("id");dvizh.cart.deleteElement(a,c);if(lineSelector=jQuery(b).data("line-selector")){jQuery(b).parents(lineSelector).last().hide("slow")}return false});jQuery(document).on("click",".dvizh-arr",this.changeInputValue);jQuery(document).on("change",".dvizh-cart-element-before-count",this.changeBeforeElementCount);jQuery(document).on("change",".dvizh-option-values-before",this.changeBeforeElementOptions);jQuery(document).on("change",".dvizh-option-values",this.changeElementOptions);return true},elementsListWidgetParams:[],jsonResult:null,csrf:null,csrf_param:null,changeElementOptions:function(){jQuery(document).trigger("changeCartElementOptions",this);var d=jQuery(this).data("id");var a={};if(jQuery(this).is("select")){var b=jQuery(".dvizh-cart-option"+d)}else{var b=jQuery(".dvizh-cart-option"+d+":checked");console.log("radio")}jQuery(b).each(function(){var e=jQuery(this).data("id");a[d]=jQuery(this).val()});var c={};c.CartElement={};c.CartElement.id=d;c.CartElement.options=JSON.stringify(a);dvizh.cart.sendData(c,jQuery(this).data("href"));return false},changeBeforeElementOptions:function(){var d=jQuery(this).data("id");var c=jQuery(this).data("filter-id");var a=jQuery(".dvizh-cart-buy-button"+d);var b=jQuery(a).data("options");if(!b){b={}}b[c]=jQuery(this).val();jQuery(a).data("options",b);jQuery(a).attr("data-options",b);jQuery(document).trigger("beforeChangeCartElementOptions",d);return true},deleteElement:function(a,b){dvizh.cart.sendData({elementId:a},b);return false},changeInputValue:function(){var b=parseInt(jQuery(this).siblings("input").val());var a=jQuery(this).siblings("input");if(jQuery(this).hasClass("dvizh-downArr")){if(b<=0){return false}jQuery(a).val(b-1)}else{jQuery(a).val(b+1)}jQuery(a).change();return false},changeBeforeElementCount:function(){if(jQuery(this).val()<=0){jQuery(this).val("0")}var b=jQuery(this).data("id");var a=jQuery(".dvizh-cart-buy-button"+b);jQuery(a).data("count",jQuery(this).val());jQuery(a).attr("data-count",jQuery(this).val());return true},changeElementCost:function(a,c){var b=jQuery(".dvizh-cart-element-price"+a).html()*c;jQuery(".dvizh-cart-element-cost"+a).html(b)},changeElementCount:function(b,d,a){var c={};c.CartElement={};c.CartElement.id=b;c.CartElement.count=d;dvizh.cart.sendData(c,a);return false},addElement:function(b,g,f,e,c,a){var d={};d.CartElement={};d.CartElement.model=b;d.CartElement.item_id=g;d.CartElement.count=f;d.CartElement.price=e;d.CartElement.options=c;dvizh.cart.sendData(d,a);return false},truncate:function(a){dvizh.cart.sendData({},a);return false},sendData:function(b,a){if(!a){a="/cart/element/create"}jQuery(document).trigger("sendDataToCart",b);b.elementsListWidgetParams=dvizh.cart.elementsListWidgetParams;b[dvizh.cart.csrf_param]=dvizh.cart.csrf;jQuery(".dvizh-cart-block").css({opacity:"0.3"});jQuery(".dvizh-cart-count").css({opacity:"0.3"});jQuery(".dvizh-cart-price").css({opacity:"0.3"});jQuery.post(a,b,function(c){jQuery(".dvizh-cart-block").css({opacity:"1"});jQuery(".dvizh-cart-count").css({opacity:"1"});jQuery(".dvizh-cart-price").css({opacity:"1"});if(c.result=="fail"){console.log(c.error)}else{dvizh.cart.renderCart(c);$(document).trigger("dvizhCartChanged")}},"json");return false},renderCart:function(a){if(!a){var a={};jQuery.post("/cart/default/info",{},function(b){a=b},"json")}jQuery(".dvizh-cart-block").replaceWith(a.elementsHTML);jQuery(".dvizh-cart-count").html(a.count);jQuery(".dvizh-cart-price").html(a.price);jQuery(document).trigger("renderCart",a);return true}};$(function(){dvizh.cart.init()});